<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
                xmlns:mx="library://ns.adobe.com/flex/mx"
                width="350" height="250"
                title="修改当前需求、净需"
                layout="vertical"
                showCloseButton="true"
                creationComplete="sendSms()"
                close="PopUpManager.removePopUp(this);"
                keyDown="if(event.charCode == Keyboard.ESCAPE) PopUpManager.removePopUp(this);">
    <fx:Script>
        <![CDATA[
        import com.github.izerui.file.utils.RemoteObjectUtils;

        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;
        import mx.utils.UIDUtil;

        [Bindable]
        public var demandItem:Object;

        private function updateQty():void {
            if (!code.text) {
                return;
            }
            RemoteObjectUtils.execute("demandService", "updateDemand", function (event:ResultEvent) {
                        close();
                    }
                    , "13911523134"
                    , code.text
                    , demandItem.entCode
                    , demandItem.businessKey
                    , UIDUtil.createUID()
                    , "手动调整前:【单需:" + demandItem.demandQty + " 单净需:" + demandItem.purgeQty+"】"
                    , demandItem.inventoryId
                    , demand.value - demandItem.demandQty
                    , purge.value - demandItem.purgeQty);
        }

        private function sendSms():void {
            RemoteObjectUtils.execute("demandService", "sendUpdateDemandCaptcha", function (event:ResultEvent) {
            }, "13911523134");
        }

        private function close():void {
            PopUpManager.removePopUp(this);
            var e:Event = new Event("DataChange",true);
            this.dispatchEvent(e);
        }
        ]]>
    </fx:Script>
    <fx:Declarations>
        <!-- 将非可视元素（例如服务、值对象）放在此处 -->
    </fx:Declarations>
    <fx:Metadata>
        [Event(name="DataChange", type="flash.events.Event")]
    </fx:Metadata>
    <mx:Form>
        <mx:FormItem label="当前需求">
            <mx:NumericStepper id="demand" width="200" value="{demandItem.demandQty}" minimum="0"
                               maximum="{Number.MAX_VALUE}"
                               stepSize="0.00000001"/>
        </mx:FormItem>
        <mx:FormItem label="当前净需">
            <mx:NumericStepper id="purge" width="200" value="{demandItem.purgeQty}" minimum="0"
                               maximum="{Number.MAX_VALUE}"/>
        </mx:FormItem>
        <mx:FormItem label="验证码">
            <mx:TextInput id="code"/>
        </mx:FormItem>
    </mx:Form>
    <mx:ControlBar horizontalAlign="right">
        <mx:Button label="确定" click="updateQty()"/>
    </mx:ControlBar>
</mx:TitleWindow>
