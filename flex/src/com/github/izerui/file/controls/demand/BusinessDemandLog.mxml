<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:mx="library://ns.adobe.com/flex/mx"
                layout="vertical"
                creationComplete="loadData()"
                showCloseButton="true"
                width="{this.parentApplication.width - 100}"
                height="{this.parentApplication.height - 100}"
                close="PopUpManager.removePopUp(this);"
                title="订单: {selItem.businessKey} 现在的物料需求情况"
                keyDown="if(event.charCode == Keyboard.ESCAPE) PopUpManager.removePopUp(this);">

    <mx:DataGrid id="grid" width="100%" height="100%" variableRowHeight="true">
        <mx:columns>
            <mx:DataGridColumn dataField="index" textAlign="center"
                               headerText="序号"
                               labelFunction="indexNumLabelFun"
                               width="40"/>
            <mx:DataGridColumn dataField="businessKey" width="250" textAlign="center"
                               headerText="业务主键"/>
            <mx:DataGridColumn dataField="businessDocNo" width="120" textAlign="center"
                               headerText="订单号"/>
            <mx:DataGridColumn dataField="businessTypeName" textAlign="center"
                               headerText="订单类型"/>
            <mx:DataGridColumn dataField="inventoryCode" textAlign="center"
                               headerText="货品编码"/>
            <mx:DataGridColumn dataField="inventoryName" textAlign="center"
                               headerText="货品名称"/>
            <mx:DataGridColumn dataField="attributeName" textAlign="center"
                               headerText="货品属性"/>
            <mx:DataGridColumn dataField="businessTypeName" textAlign="center"
                               headerText="订单类型"/>
            <mx:DataGridColumn dataField="demandQty" textAlign="center"
                               headerText="需求量"/>
            <mx:DataGridColumn dataField="purgeQty" textAlign="center"
                               headerText="在途在制量"/>
            <mx:DataGridColumn dataField="stockQty" textAlign="center"
                               headerText="库存量"/>
            <mx:DataGridColumn dataField="usableQty" textAlign="center"
                               headerText="可用量"/>
            <mx:DataGridColumn dataField="createTime" width="120" textAlign="center"
                               labelFunction="dateLabelFun"
                               headerText="创建时间"/>
            <mx:DataGridColumn dataField="updateTime" width="120" textAlign="center"
                               labelFunction="dateLabelFun2"
                               headerText="更新时间"/>
        </mx:columns>
    </mx:DataGrid>
    <fx:Script><![CDATA[
        import com.github.izerui.file.components.loading.LoaderManager;
        import com.github.izerui.file.utils.RemoteObjectUtils;

        import mx.formatters.DateFormatter;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        [Bindable]
        public var selItem:Object;

        private function loadData():void {
            LoaderManager.showLoading();
            RemoteObjectUtils.execute("demandService", "findDemandResults", function (event:ResultEvent) {
                LoaderManager.hideLoading();
                grid.dataProvider = event.result;
            }, selItem.entCode, selItem.businessKey)

        }

        private function dateLabelFun(item:Object, column:DataGridColumn):String {
            var df:DateFormatter = new DateFormatter();
            df.formatString = "YYYY-MM-DD JJ:NN:SS";
            return df.format(item.createTime);
        }
        private function dateLabelFun2(item:Object, column:DataGridColumn):String {
            var df:DateFormatter = new DateFormatter();
            df.formatString = "YYYY-MM-DD JJ:NN:SS";
            return df.format(item.updateTime);
        }

        private function indexNumLabelFun(item:Object, column:DataGridColumn):String {
            var indexNum:int = (grid.dataProvider.getItemIndex(item) + 1);
            return indexNum.toString();
        }
        ]]>
    </fx:Script>
</mx:TitleWindow>
